generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model RegistroTipo1 {
  id                          String  @id @default(uuid())
  tipo                        String
  idSequencial                String
  tipoIdentificadorEmpregador String
  cnpjCpfEmpregador           String
  cnoCaepf                    String
  razaoSocial                 String
  numeroFabricacao            String
  dataInicial                 String
  dataFinal                   String
  dataHoraGeracao             String
  versaoLayout                String
  tipoIdentificadorFabricante String
  cnpjCpfFabricante           String
  modelo                      String
  crc                         String
  origem                      String?

  @@map("registros_cabecalho")
}

model RegistroTipo10 {
  id         String @id @default(uuid())
  ultimo_nsr Int    @unique
  origem     String @unique

  @@map("registros_ultimo_nsr")
}

model MarcacoesRelogio {
  id           String   @id @default(uuid())
  nsr          Int
  tipo         String
  dataCompleta DateTime @map("data_completa")
  data         String
  hora         String
  cpfEmpregado String
  crc          String
  origem       String?

  @@unique([nsr, cpfEmpregado, data, hora, origem])
  @@map("marcac√µes_de_ponto")
}

model EspelhoDiario {
  id                           Int                            @id @default(autoincrement())
  cpf                          String
  mesAno                       String
  diaDoMes                     String
  credito                      Float
  debito                       Float
  horasNormais                 Float
  horasExtras                  Float
  saldo                        Float
  motivoReajuste               String?
  data                         String
  primeiraEntrada              String?
  primeiraSaida                String?
  segundaEntrada               String?
  segundaSaida                 String?
  horasTrabalhadas             Float
  observacoes                  String
  status                       String
  origem                       String?
  bancoDeHoras                 Float
  horasAlmoco                  Float                          @map("horas_do_almoco")
  EspelhoDiarioToEspelhoMensal EspelhoDiarioToEspelhoMensal[]

  @@map("espelho_diario")
}

model MarcacoesUsuario {
  id             String    @id @default(uuid())
  pimeiraEntrada DateTime  @map("primeira_entrada")
  primeiraSaida  DateTime  @map("primeira_saida")
  segundaEntrada DateTime  @map("segunda_entrada")
  segundaSaida   DateTime  @map("segunda_saida")
  pausaAlmoco    DateTime? @map("pausa_do_almoco")
}

model EspelhoDePontoMensal {
  id               String  @id @default(uuid())
  mesEmAberto      Boolean @default(false)
  cpf              String
  mesAno           String
  diaDoMes         String
  credito          Float
  debito           Float
  horasNormais     Float
  horasExtras      Float
  saldo            Float
  motivoReajuste   String?
  data             String
  primeiraEntrada  String?
  primeiraSaida    String?
  segundaEntrada   String?
  segundaSaida     String?
  horasTrabalhadas Float
  observacoes      String
  status           String
  origem           String?

  @@map("espelho_de_ponto_mensal")
}

model EspelhoMensal {
  id                           String                         @id @default(uuid())
  cpf                          String
  mesAno                       String                         @map("mes_ano")
  diasUteis                    Int                            @map("dias_uteis")
  diasTrabalhados              Int                            @map("dias_trabalhados")
  registrosCorretos            Int?                           @map("dias_corridos")
  ajustesEAbonos               Int?                           @map("ajustes_e_abonos")
  faltas                       Int?
  totalHorasTrabalhadas        Float                          @map("totoal_de_horas_trabalhadas")
  totalHorasDevidas            Float                          @map("total_de_horas_devidas")
  saldoHoras                   Float                          @map("saldo_horas")
  dataCriacao                  DateTime                       @default(now()) @map("data_criacao")
  MesAberto                    Boolean                        @default(false)
  EspelhoDiarioToEspelhoMensal EspelhoDiarioToEspelhoMensal[]

  @@unique([cpf, mesAno])
  @@map("espelho_de_atual")
}

model Frequencia {
  id              String    @id @default(uuid())
  cpf             String
  data            DateTime
  primeiraEntrada DateTime?
  primeiraSaida   DateTime?
  segundaEntrada  DateTime?
  segundaSaida    DateTime?

  @@unique([cpf, data])
  @@map("frequencia")
}

model BancoDeHoras {
  id                String   @id @default(uuid())
  cpf               String   @unique
  saldoHoras        Float
  ultimaAtualizacao DateTime @default(now()) @map("ultima_atualizacao")

  @@map("banco_de_horas")
}

model Recesso {
  id                   String   @id @default(uuid())
  ano                  DateTime @map("ano")
  descricao            String   @map("descricao")
  processoSei          String   @map("processo_sei")
  abertoParaFrequencia Boolean  @default(false) @map("aberto_para_frequencia")
  DataInicial          DateTime @map("data_inicial")
  dataFinal            DateTime @map("data_final")
  createdAt            DateTime @default(now()) @map("created_at")
  updatedAt            DateTime @updatedAt @map("updated_at")
  escalas              Escala[]

  @@index([ano])
}

model Lotacao {
  id      String   @id @default(uuid())
  nome    String   @unique
  codigo  String?
  escalas Escala[]
}

model Escala {
  id                String        @id @default(uuid())
  nome              String
  lotacaoId         String
  recebePagamento   Boolean       @default(false)
  escalado          Boolean       @default(false)
  createdAt         DateTime      @default(now())
  updatedAt         DateTime?
  recessoId         String
  dataEscala        DateTime      @map("data_escala")
  chefeId           String?
  chefeMatricula    String?
  motivo            String?
  servidorId        String?
  servidorMatricula String?
  chefe             Funcionario?  @relation("EscalaChefe", fields: [chefeId], references: [id])
  lotacao           Lotacao       @relation(fields: [lotacaoId], references: [id])
  recesso           Recesso       @relation(fields: [recessoId], references: [id], onDelete: Cascade)
  servidor          Funcionario?  @relation("EscalaServidor", fields: [servidorId], references: [id])
  solicitacoes      Solicitacao[]

  @@unique([nome, recessoId])
  @@index([recessoId])
  @@index([lotacaoId])
  @@index([servidorId])
  @@index([chefeId])
}

model Funcionario {
  id                    String        @id @default(uuid())
  nome                  String
  matricula             String        @unique
  email                 String?       @unique
  role                  Role          @default(USER)
  createdAt             DateTime      @default(now())
  updatedAt             DateTime?
  managerId             String?
  escalasComoChefe      Escala[]      @relation("EscalaChefe")
  escalasComoServidor   Escala[]      @relation("EscalaServidor")
  manager               Funcionario?  @relation("ManagerRelation", fields: [managerId], references: [id])
  subordinates          Funcionario[] @relation("ManagerRelation")
  solicitacoesAprovadas Solicitacao[] @relation("Aprovador")
  solicitacoesCriadas   Solicitacao[] @relation("Criador")

  @@index([role])
}

model Solicitacao {
  id                String            @id @default(uuid())
  escalaId          String
  criadorId         String
  aprovadorId       String?
  status            SolicitacaoStatus @default(PENDENTE)
  motivo            String?
  createdAt         DateTime          @default(now())
  updatedAt         DateTime?
  servidorMatricula String?
  dia               DateTime
  entrada1          DateTime?
  entrada2          DateTime?
  lotacao           String?
  nomeChefia        String?
  opcao             String?
  saida1            DateTime?
  saida2            DateTime?
  nomeServidor      String?
  aprovador         Funcionario?      @relation("Aprovador", fields: [aprovadorId], references: [id])
  criador           Funcionario       @relation("Criador", fields: [criadorId], references: [id])
  escala            Escala            @relation(fields: [escalaId], references: [id], onDelete: Cascade)

  @@index([escalaId])
  @@index([criadorId])
  @@index([aprovadorId])
  @@index([status])
}

model EspelhoDiarioToEspelhoMensal {
  A                Int
  B                String
  espelho_diario   EspelhoDiario @relation(fields: [A], references: [id], onDelete: Cascade)
  espelho_de_atual EspelhoMensal @relation(fields: [B], references: [id], onDelete: Cascade)

  @@id([A, B], map: "_EspelhoDiarioToEspelhoMensal_AB_pkey")
  @@index([B], map: "_EspelhoDiarioToEspelhoMensal_B_index")
  @@map("_EspelhoDiarioToEspelhoMensal")
}

/// The underlying table does not contain a valid unique identifier and can therefore currently not be handled by Prisma Client.
model sarh_funcionario {
  COD_FUNCIONARIO Decimal @db.Decimal(10, 0)
  CPF             String?  @db.VarChar(4000)
  NOME            String?  @db.VarChar(50)
  MATRICULA       String?  @db.VarChar(15)
  E_MAIL          String?  @db.VarChar(60)
  ENDERECO        String?  @db.VarChar(100)
  BAIRRO          String?  @db.VarChar(50)
  CIDADE          String?  @db.VarChar(50)
  TELEFONE        String?  @db.VarChar(20)
  ID_TIPO_LOTACAO Int?
  LOTACAO         String?  @db.VarChar(120)
  SIGLA           String?  @db.VarChar(20)
  CARGO           String?  @db.VarChar(100)

  @@id([COD_FUNCIONARIO])
}

enum Role {
  USER
  CHEFE
  ADMIN
}

enum SolicitacaoStatus {
  PENDENTE
  APROVADA
  RECUSADA
  CANCELADA
}
